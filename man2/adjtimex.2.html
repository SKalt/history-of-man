<!--
Copyright (c) 1995 Michael Chastain (mec@shell.portal.com), 15 April 1995.
%%%LICENSE_START(GPLv2+_DOC_FULL)
This is free documentation; you can redistribute it and/or
modify it under the terms of the GNU General Public License as
published by the Free Software Foundation; either version 2 of
the License, or (at your option) any later version.
.\"
The GNU General Public License's references to "object code"
and "executables" are to be interpreted as the output of any
document formatting or typesetting system, including
intermediate and printed output.
.\"
This manual is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.
.\"
You should have received a copy of the GNU General Public
License along with this manual; if not, see
&lt;http://www.gnu.org/licenses/&gt;.
%%%LICENSE_END
-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML><HEAD><TITLE>Man page of ADJTIMEX</TITLE>
</HEAD><BODY>
<H1>ADJTIMEX</H1>
Section: Linux Programmer's Manual (2)<BR>Updated: 2014-12-31<BR><A HREF="#index">Index</A>
<A HREF="../index.html">Return to Main Contents</A><HR>

<A NAME="lbAB">&nbsp;</A>
<H2>NAME</H2>

adjtimex - tune kernel clock
<A NAME="lbAC">&nbsp;</A>
<H2>SYNOPSIS</H2>

<PRE>
<B>#define _BSD_SOURCE</B>      /* See <A HREF="../man7/feature_test_macros.7.html">feature_test_macros</A>(7) */
<B>#include &lt;<A HREF="file:///usr/include/sys/timex.h">sys/timex.h</A>&gt;</B>

<B>int adjtimex(struct timex *</B><I>buf</I><B>);</B>
</PRE>

<A NAME="lbAD">&nbsp;</A>
<H2>DESCRIPTION</H2>

Linux uses David L. Mills' clock adjustment algorithm (see RFC&nbsp;5905).
The system call
<B>adjtimex</B>()

reads and optionally sets adjustment parameters for this algorithm.
It takes a pointer to a
<I>timex</I>

structure, updates kernel parameters from field values,
and returns the same structure with current kernel values.
This structure is declared as follows:
<P>


<PRE>
struct timex {
    int  modes;      /* Mode selector */
    long offset;     /* Time offset; nanoseconds, if STA_NANO
                        status flag is set, otherwise microseconds */
    long freq;       /* Frequency offset, in units of 2^-16 ppm
                        (parts per million, see NOTES below) */
    long maxerror;   /* Maximum error (microseconds) */
    long esterror;   /* Estimated error (microseconds) */
    int  status;     /* Clock command/status */
    long constant;   /* PLL (phase-locked loop) time constant */
    long precision;  /* Clock precision (microseconds, read-only) */
    long tolerance;  /* Clock frequency tolerance (ppm, read-only) */
    struct timeval time;
                     /* Current time (read-only, except for
                        ADJ_SETOFFSET); upon return, time.tv_usec
                        contains nanoseconds, if STA_NANO status
                        flag is set, otherwise microseconds */
    long tick;       /* Microseconds between clock ticks */
    long ppsfreq;    /* PPS (pulse per second) frequency (in units
                        of 2^-16 ppm--see NOTES, read-only) */
    long jitter;     /* PPS jitter (read-only); nanoseconds, if
                        STA_NANO status flag is set, otherwise
                        microseconds */
    int  shift;      /* PPS interval duration (seconds, read-only) */
    long stabil;     /* PPS stability (2^-16 ppm--see NOTES,
                        read-only) */
    long jitcnt;     /* PPS jitter limit exceeded (read-only) */
    long calcnt;     /* PPS calibration intervals (read-only) */
    long errcnt;     /* PPS calibration errors (read-only) */
    long stbcnt;     /* PPS stability limit exceeded (read-only) */
    int tai;         /* TAI offset, as set by previous ADJ_TAI
                        operation (seconds, read-only,
                        since Linux 2.6.26) */
    /* Further padding bytes to allow for future expansion */
};
</PRE>


<P>

The
<I>modes</I>

field determines which parameters, if any, to set.
It is a bit mask containing a
bitwise-<I>or</I>

combination of zero or more of the following bits:
<DL COMPACT>
<DT><B>ADJ_OFFSET</B>

<DD>
Set time offset from
<I>buf.offset</I>.

<DT><B>ADJ_FREQUENCY</B>

<DD>
Set frequency offset from
<I>buf.freq</I>.

<DT><B>ADJ_MAXERROR</B>

<DD>
Set maximum time error from
<I>buf.maxerror</I>.

<DT><B>ADJ_ESTERROR</B>

<DD>
Set estimated time error from
<I>buf.esterror</I>.

<DT><B>ADJ_STATUS</B>

<DD>
Set clock status from
<I>buf.status</I>.

<DT><B>ADJ_TIMECONST</B>

<DD>
Set PLL time constant from
<I>buf.constant</I>.

If the
<B>STA_NANO</B>

status flag (see below) is clear, the kernel adds 4 to this value.
<DT><B>ADJ_SETOFFSET</B> (since Linux 2.6.29)

<DD>


Add
<I>buf.time</I>

to the current time.
If
<I>buf.status</I>

includes the
<B>ADJ_NANO</B>

flag, then
<I>buf.time.tv_usec</I>

is interpreted as a nanosecond value;
otherwise it is interpreted as microseconds.
<DT><B>ADJ_MICRO</B> (since Linux 2.6.36)

<DD>


Select microsecond resolution.
<DT><B>ADJ_NANO</B> (since Linux 2.6.36)

<DD>


Select nanosecond resolution.
Only one of
<B>ADJ_MICRO</B>

and
<B>ADJ_NANO</B>

should be specified.
<DT><B>ADJ_TAI</B> (since Linux 2.6.26)

<DD>

Set TAI (Atomic International Time) offset from
<I>buf-&gt;constant</I>.

<P>
<B>ADJ_TAI</B>

should not be used in conjunction with
<B>ADJ_TIMECONST</B>,

since the latter mode also employs the
<I>buf-&gt;constant</I>

field.
<P>
For a complete explanation of TAI
and the difference between TAI and UTC, see

<I>BIPM</I>


<DT><B>ADJ_TICK</B>

<DD>
Set tick value from
<I>buf.tick</I>.

</DL>
<P>

Alternatively,
<I>modes</I>

can be specified as either of the following (multibit mask) values,
in which case other bits should not be specified in
<I>modes</I>:



<DL COMPACT>
<DT><B>ADJ_OFFSET_SINGLESHOT</B>

<DD>


Old-fashioned
<B>adjtime</B>():

(gradually) adjust time by value specified in
<I>buf.offset</I>,

which specifies an adjustment in microseconds.
<DT><B>ADJ_OFFSET_SS_READ</B> (functional since Linux 2.6.28)

<DD>



Return (in
<I>buf.offset</I>)

the remaining amount of time to be adjusted after an earlier
<B>ADJ_OFFSET_SINGLESHOT</B>

operation.
This feature was added in Linux 2.6.24,

but did not work correctly

until Linux 2.6.28.
</DL>
<P>

Ordinary users are restricted to a value of either 0 or
<B>ADJ_OFFSET_SS_READ</B>

for
<I>modes</I>.

Only the superuser may set any parameters.
<P>
The
<I>buf.status</I>

field is a bit mask that is used to set and/or retrieve status
bits associated with the NTP implementation.
Some bits in the mask are both readable and settable,
while others are read-only.
<DL COMPACT>
<DT><B>STA_PLL</B>

<DD>
Enable phase-locked loop (PLL) updates (read-write) via
<B>ADJ_OFFSET</B>.

<DT><B>STA_PPSFREQ</B>

<DD>
Enable PPS freq discipline (read-write).
<DT><B>STA_PPSTIME</B>

<DD>
Enable PPS time discipline (read-write).
<DT><B>STA_FLL</B>

<DD>
Select frequency-locked loop (FLL) mode (read-write).
<DT><B>STA_INS</B>

<DD>
Insert leap second (read-write).
<DT><B>STA_DEL</B>

<DD>
Delete leap second (read-write).
<DT><B>STA_UNSYNC</B>

<DD>
Clock unsynchronized (read-write).
<DT><B>STA_FREQHOLD</B>

<DD>
Hold frequency (read-write).
<DT><B>STA_PPSSIGNAL</B>

<DD>
PPS signal present (read-only).
<DT><B>STA_PPSJITTER</B>

<DD>
PPS signal jitter exceeded (read-only).
<DT><B>STA_PPSWANDER</B>

<DD>
PPS signal wander exceeded (read-only).
<DT><B>STA_PPSERROR</B>

<DD>
PPS signal calibration error (read-only).
<DT><B>STA_CLOCKERR</B>

<DD>
Clock hardware fault (read-only).
<DT><B>STA_NANO</B> (since Linux 2.6.26)

<DD>


Resolution (0 = microsecond, 1 = nanoseconds; read-only).
Set via
<B>ADJ_NANO</B>,

cleared via
<B>ADJ_MICRO</B>.

<DT><B>STA_MODE</B> (since Linux 2.6.26)

<DD>


Mode (0 = Phase Locked Loop, 1 = Frequency Locked Loop; read-only).
<DT><B>STA_CLK</B> (since Linux 2.6.26)

<DD>


Clock source (0 = A, 1 = B; read-only).


</DL>
<P>

Attempts to set read-only
<I>status</I>

bits are silently ignored.
<A NAME="lbAE">&nbsp;</A>
<H2>RETURN VALUE</H2>

On success,
<B>adjtimex</B>()

returns the clock state; that is, one of the following values:
<DL COMPACT>
<DT><B>TIME_OK</B>

<DD>
Clock synchronized.
<DT><B>TIME_INS</B>

<DD>
Insert leap second.
<DT><B>TIME_DEL</B>

<DD>
Delete leap second.
<DT><B>TIME_OOP</B>

<DD>
Leap second in progress.
<DT><B>TIME_WAIT</B>

<DD>
Leap second has occurred.
<DT><B>TIME_ERROR</B>

<DD>
Clock not synchronized.
The symbolic name
<B>TIME_BAD</B>

is a synonym for
<B>TIME_ERROR</B>,

provided for backward compatibility.
</DL>
<P>

On failure,
<B>adjtimex</B>()

returns -1 and sets
<I>errno</I>.

<A NAME="lbAF">&nbsp;</A>
<H2>ERRORS</H2>

<DL COMPACT>
<DT><B>EFAULT</B>

<DD>
<I>buf</I>

does not point to writable memory.
<DT><B>EINVAL</B>

<DD>
An attempt was made to set
<I>buf.offset</I>

to a value outside the range -131071 to +131071,
or to set
<I>buf.status</I>

to a value other than those listed above,
or to set
<I>buf.tick</I>

to a value outside the range
900000/<B>HZ</B>

to
1100000/<B>HZ</B>,

where
<B>HZ</B>

is the system timer interrupt frequency.
<DT><B>EPERM</B>

<DD>
<I>buf.modes</I>

is neither 0 nor
<B>ADJ_OFFSET_SS_READ</B>,

and the caller does not have sufficient privilege.
Under Linux, the
<B>CAP_SYS_TIME</B>

capability is required.
</DL>
<A NAME="lbAG">&nbsp;</A>
<H2>NOTES</H2>

In struct
<I>timex</I>,

<I>freq</I>,

<I>ppsfreq</I>,

and
<I>stabil</I>

are ppm (parts per million) with a 16-bit fractional part,
which means that a value of 1 in one of those fields
actually means 2^-16 ppm, and 2^16=65536 is 1 ppm.
This is the case for both input values (in the case of
<I>freq</I>)

and output values.
<A NAME="lbAH">&nbsp;</A>
<H2>CONFORMING TO</H2>

<B>adjtimex</B>()

is Linux-specific and should not be used in programs
intended to be portable.
See
<B><A HREF="../man3/adjtime.3.html">adjtime</A></B>(3)

for a more portable, but less flexible,
method of adjusting the system clock.
<A NAME="lbAI">&nbsp;</A>
<H2>SEE ALSO</H2>

<B><A HREF="../man2/settimeofday.2.html">settimeofday</A></B>(2),

<B><A HREF="../man3/adjtime.3.html">adjtime</A></B>(3),

<B><A HREF="../man7/capabilities.7.html">capabilities</A></B>(7),

<B><A HREF="../man7/time.7.html">time</A></B>(7),

<B><A HREF="../man8/adjtimex.8.html">adjtimex</A></B>(8)

<P>

<HR>
<A NAME="index">&nbsp;</A><H2>Index</H2>
<DL>
<DT><A HREF="#lbAB">NAME</A><DD>
<DT><A HREF="#lbAC">SYNOPSIS</A><DD>
<DT><A HREF="#lbAD">DESCRIPTION</A><DD>
<DT><A HREF="#lbAE">RETURN VALUE</A><DD>
<DT><A HREF="#lbAF">ERRORS</A><DD>
<DT><A HREF="#lbAG">NOTES</A><DD>
<DT><A HREF="#lbAH">CONFORMING TO</A><DD>
<DT><A HREF="#lbAI">SEE ALSO</A><DD>
</DL>
<HR>
This document was created by
<A HREF="http://localhost/cgi-bin/man/man2html">man2html</A>,
using the manual pages.<BR>
Time: 03:39:24 GMT, April 20, 2020
</BODY>
</HTML>
