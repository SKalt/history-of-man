<!--
-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML><HEAD><TITLE>Man page of CAPGET</TITLE>
</HEAD><BODY>
<H1>CAPGET</H1>
Section: Linux Programmer's Manual (2)<BR>Updated: 2004-06-21<BR><A HREF="#index">Index</A>
<A HREF="../index.html">Return to Main Contents</A><HR>

<A NAME="lbAB">&nbsp;</A>
<H2>NAME</H2>

capget, capset - set/get capabilities
<A NAME="lbAC">&nbsp;</A>
<H2>SYNOPSIS</H2>

<B>#undef _POSIX_SOURCE</B>

<BR>

<B>#include &lt;<A HREF="file:///usr/include/sys/capability.h">sys/capability.h</A>&gt;</B>

<P>
<B>int capget(cap_user_header_t </B><I>hdrp</I><B>, cap_user_data_t </B><I>datap</I><B>);</B>

<P>
<B>int capset(cap_user_header_t </B><I>hdrp</I><B>, const cap_user_data_t </B><I>datap</I><B>);</B>

<A NAME="lbAD">&nbsp;</A>
<H2>DESCRIPTION</H2>

As of Linux 2.2, the power of the superuser (root) has been partitioned into
a set of discrete capabilities.
Every thread has a set of effective capabilities identifying
which capabilities (if any) it may currently exercise.
Every thread also has a set of inheritable capabilities that may be
passed through an
<B><A HREF="../man2/execve.2.html">execve</A></B>(2)

call, and a set of permitted capabilities
that it can make effective or inheritable.
<P>

These two functions are the raw kernel interface for getting and
setting capabilities.
Not only are these system calls specific to Linux,
but the kernel API is likely to change and use of
these functions (in particular the format of the
<I>cap_user_*_t</I>

types) is subject to change with each kernel revision.
<P>
The portable interfaces are
<B><A HREF="../man3/cap_set_proc.3.html">cap_set_proc</A></B>(3)

and
<B><A HREF="../man3/cap_get_proc.3.html">cap_get_proc</A></B>(3);

if possible you should use those interfaces in applications.
If you wish to use the Linux extensions in applications, you should
use the easier-to-use interfaces
<B><A HREF="../man3/capsetp.3.html">capsetp</A></B>(3)

and
<B><A HREF="../man3/capgetp.3.html">capgetp</A></B>(3).

<A NAME="lbAE">&nbsp;</A>
<H3>Current details</H3>

Now that you have been warned, some current kernel details.
The structs are defined as follows.
<P>
<PRE>
#define _LINUX_CAPABILITY_VERSION  0x19980330

typedef struct __user_cap_header_struct {
    int version;
    int pid;
} *cap_user_header_t;

typedef struct __user_cap_data_struct {
    int effective;
    int permitted;
    int inheritable;
} *cap_user_data_t;
</PRE>


<P>
The calls will return
<B>EINVAL</B>,

and set the
<I>version</I>

field of
<I>hdrp</I>

to
<B>_LINUX_CAPABILITY_VERSION</B>

when another version was specified.
<P>
The calls operate on the capabilities of the thread specified by the
<I>pid</I>

field of
<I>hdrp</I>

when that is non-zero, or on the capabilities of the calling thread if
<I>pid</I>

is 0.
If
<I>pid</I>

refers to a single-threaded process, then
<I>pid</I>

can be specified as a traditional process ID;
operating on a thread of a multithreaded process requires a thread ID
of the type returned by
<B><A HREF="../man2/gettid.2.html">gettid</A></B>(2).

For
<B>capset</B>(),

<I>pid</I>

can also be: -1, meaning perform the change on all threads except the
caller and
<B><A HREF="../man8/init.8.html">init</A></B>(8);

or a value less than -1, in which case the change is applied
to all members of the process group whose ID is -<I>pid</I>.
<P>
For details on the data, see
<B><A HREF="../man7/capabilities.7.html">capabilities</A></B>(7).

<A NAME="lbAF">&nbsp;</A>
<H2>RETURN VALUE</H2>

On success, zero is returned.
On error, -1 is returned, and
<I>errno</I>

is set appropriately.
<A NAME="lbAG">&nbsp;</A>
<H2>ERRORS</H2>

<DL COMPACT>
<DT><B>EFAULT</B>

<DD>
Bad memory address.
Neither of
<I>hdrp</I>

and
<I>datap</I>

may be NULL.
<DT><B>EINVAL</B>

<DD>
One of the arguments was invalid.
<DT><B>EPERM</B>

<DD>
An attempt was made to add a capability to the Permitted set, or to set
a capability in the Effective or Inheritable sets that is not in the
Permitted set.
<DT><B>EPERM</B>

<DD>
The caller attempted to use
<B>capset</B>()

to modify the capabilities of a thread other than itself,
but lacked sufficient privilege; the
<B>CAP_SETPCAP</B>

capability is required.
(A bug in kernels before 2.6.11 meant that this error could also
occur if a thread without this capability tried to change its
own capabilities by specifying the
<I>pid</I>

field as a non-zero value (i.e., the value returned by
<B><A HREF="../man2/getpid.2.html">getpid</A></B>(2))

instead of 0.)
<DT><B>ESRCH</B>

<DD>
No such thread.
</DL>
<A NAME="lbAH">&nbsp;</A>
<H2>CONFORMING TO</H2>

These system calls are Linux-specific.
<A NAME="lbAI">&nbsp;</A>
<H2>NOTES</H2>

The portable interface to the capability querying and setting
functions is provided by the
<I>libcap</I>

library and is available here:
<BR>

<I><A HREF="ftp://ftp.kernel.org/pub/linux/libs/security/linux-privs">ftp://ftp.kernel.org/pub/linux/libs/security/linux-privs</A></I>

<A NAME="lbAJ">&nbsp;</A>
<H2>SEE ALSO</H2>

<B><A HREF="../man2/clone.2.html">clone</A></B>(2),

<B><A HREF="../man2/gettid.2.html">gettid</A></B>(2),

<B><A HREF="../man7/capabilities.7.html">capabilities</A></B>(7)

<P>

<HR>
<A NAME="index">&nbsp;</A><H2>Index</H2>
<DL>
<DT><A HREF="#lbAB">NAME</A><DD>
<DT><A HREF="#lbAC">SYNOPSIS</A><DD>
<DT><A HREF="#lbAD">DESCRIPTION</A><DD>
<DL>
<DT><A HREF="#lbAE">Current details</A><DD>
</DL>
<DT><A HREF="#lbAF">RETURN VALUE</A><DD>
<DT><A HREF="#lbAG">ERRORS</A><DD>
<DT><A HREF="#lbAH">CONFORMING TO</A><DD>
<DT><A HREF="#lbAI">NOTES</A><DD>
<DT><A HREF="#lbAJ">SEE ALSO</A><DD>
</DL>
<HR>
This document was created by
<A HREF="http://localhost/cgi-bin/man/man2html">man2html</A>,
using the manual pages.<BR>
Time: 02:52:32 GMT, April 20, 2020
</BODY>
</HTML>
