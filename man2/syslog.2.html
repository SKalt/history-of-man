<!--
Copyright (C) 1995 Andries Brouwer (aeb@cwi.nl)
-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML><HEAD><TITLE>Man page of SYSLOG</TITLE>
</HEAD><BODY>
<H1>SYSLOG</H1>
Section: Linux Programmer's Manual (2)<BR>Updated: 2007-06-01<BR><A HREF="#index">Index</A>
<A HREF="../index.html">Return to Main Contents</A><HR>

<A NAME="lbAB">&nbsp;</A>
<H2>NAME</H2>

syslog, klogctl - read and/or clear kernel message ring buffer;
set console_loglevel
<A NAME="lbAC">&nbsp;</A>
<H2>SYNOPSIS</H2>

<PRE>
<B>int syslog(int </B><I>type</I><B>, char *</B><I>bufp</I><B>, int </B><I>len</I><B>);</B>
<B>                /* No wrapper provided in glibc */</B>

/* The glibc interface */
<BR>
<B>#include &lt;<A HREF="file:///usr/include/sys/klog.h">sys/klog.h</A>&gt;</B>

<B>int klogctl(int </B><I>type</I><B>, char *</B><I>bufp</I><B>, int </B><I>len</I><B>);</B>
</PRE>

<A NAME="lbAD">&nbsp;</A>
<H2>DESCRIPTION</H2>

If you need the libc function
<B>syslog</B>()

(which talks to
<B><A HREF="../man8/syslogd.8.html">syslogd</A></B>(8)),

then look at
<B><A HREF="../man3/syslog.3.html">syslog</A></B>(3).

The system call of this name is about controlling the kernel
<I>printk</I>()

buffer, and the glibc version is called
<B>klogctl</B>().

<P>
The <I>type</I> argument determines the action taken by this function.
<P>
Quoting from
<I>kernel/printk.c</I>:

<PRE>
/*
 * Commands to sys_syslog:
 *
 *      0 -- Close the log.  Currently a NOP.
 *      1 -- Open the log. Currently a NOP.
 *      2 -- Read from the log.
 *      3 -- Read up to the last 4k of messages in the ring buffer.
 *      4 -- Read and clear last 4k of messages in the ring buffer
 *      5 -- Clear ring buffer.
 *      6 -- Disable printk's to console
 *      7 -- Enable printk's to console
 *      8 -- Set level of messages printed to console
 *      9 -- Return number of unread characters in the log buffer
 */
</PRE>

<P>
Only function 3 is allowed to non-root processes.
(Function 9 was added in 2.4.10.)
<P>
<B>The kernel log buffer</B>

<BR>

The kernel has a cyclic buffer of length
<B>LOG_BUF_LEN</B>

(4096, since 1.3.54: 8192, since 2.1.113: 16384; in recent kernels
the size can be set at compile time) in which messages given as argument
to the kernel function
<B>printk</B>()

are stored
(regardless of their loglevel).
<P>
The call
<B>syslog</B>()

(2,<I>buf</I>,<I>len</I>)

waits until this kernel log buffer is nonempty, and then reads
at most <I>len</I> bytes into the buffer <I>buf</I>.
It returns
the number of bytes read.
Bytes read from the log disappear from
the log buffer: the information can only be read once.
This is the function executed by the kernel when a user program
reads
<I>/proc/kmsg</I>.

<P>
The call
<B>syslog</B>()

(3,<I>buf</I>,<I>len</I>)

will read the last <I>len</I> bytes from the log buffer (non-destructively),
but will not read more than was written into the buffer since the
last &quot;clear ring buffer&quot; command (which does not clear the buffer at all).
It returns the number of bytes read.
<P>
The call
<B>syslog</B>()

(4,<I>buf</I>,<I>len</I>)

does precisely the same, but also executes the &quot;clear ring buffer&quot; command.
<P>
The call
<B>syslog</B>()

(5,<I>dummy</I>,<I>idummy</I>)

only executes the &quot;clear ring buffer&quot; command.
<P>
<B>The loglevel</B>

<BR>

The kernel routine
<B>printk</B>()

will only print a message on the
console, if it has a loglevel less than the value of the variable
<I>console_loglevel</I>.

This variable initially has the value
<B>DEFAULT_CONSOLE_LOGLEVEL</B>

(7), but is set to 10 if the
kernel command line contains the word &quot;debug&quot;, and to 15 in case
of a kernel fault (the 10 and 15 are just silly, and equivalent to 8).
This variable is set (to a value in the range 1-8) by the call
<B>syslog</B>()

(8,<I>dummy</I>,<I>value</I>).

The calls
<B>syslog</B>()

(<I>type</I>,<I>dummy</I>,<I>idummy</I>)

with <I>type</I> equal to 6 or 7, set it to 1 (kernel panics only)
or 7 (all except debugging messages), respectively.
<P>
Every text line in a message has its own loglevel.
This level is
<I>DEFAULT_MESSAGE_LOGLEVEL - 1</I>

(6) unless the line starts with &lt;d&gt;
where <I>d</I> is a digit in the range 1-7, in which case the level
is <I>d</I>.
The conventional meaning of the loglevel is defined in
<I>&lt;<A HREF="file:///usr/include/linux/kernel.h">linux/kernel.h</A>&gt;</I>

as follows:
<P>
<PRE>
#define KERN_EMERG    &quot;&lt;0&gt;&quot;  /* system is unusable               */
#define KERN_ALERT    &quot;&lt;1&gt;&quot;  /* action must be taken immediately */
#define KERN_CRIT     &quot;&lt;2&gt;&quot;  /* critical conditions              */
#define KERN_ERR      &quot;&lt;3&gt;&quot;  /* error conditions                 */
#define KERN_WARNING  &quot;&lt;4&gt;&quot;  /* warning conditions               */
#define KERN_NOTICE   &quot;&lt;5&gt;&quot;  /* normal but significant condition */
#define KERN_INFO     &quot;&lt;6&gt;&quot;  /* informational                    */
#define KERN_DEBUG    &quot;&lt;7&gt;&quot;  /* debug-level messages             */
</PRE>

<A NAME="lbAE">&nbsp;</A>
<H2>RETURN VALUE</H2>

In case of error, -1 is returned, and <I>errno</I> is set.
Otherwise,
for <I>type</I> equal to 2, 3 or 4,
<B>syslog</B>()

returns the number
of bytes read, and otherwise 0.
<A NAME="lbAF">&nbsp;</A>
<H2>ERRORS</H2>

<DL COMPACT>
<DT><B>EINVAL</B>

<DD>
Bad parameters.
<DT><B>EPERM</B>

<DD>
An attempt was made to change console_loglevel or clear the kernel
message ring buffer by a process without root permissions.
<DT><B>ERESTARTSYS</B>

<DD>
System call was interrupted by a signal; nothing was read.
(This can be seen only during a trace.)
</DL>
<A NAME="lbAG">&nbsp;</A>
<H2>CONFORMING TO</H2>

This system call is Linux-specific and should not be used in programs
intended to be portable.
<A NAME="lbAH">&nbsp;</A>
<H2>NOTES</H2>

From the very start people noted that it is unfortunate that
a system call and a library routine of the same name are entirely
different animals.
In libc4 and libc5 the number of this call was defined by
<B>SYS_klog</B>.

In glibc 2.0 the syscall is baptized
<B>klogctl</B>().

<A NAME="lbAI">&nbsp;</A>
<H2>SEE ALSO</H2>

<B><A HREF="../man3/syslog.3.html">syslog</A></B>(3)

<P>

<HR>
<A NAME="index">&nbsp;</A><H2>Index</H2>
<DL>
<DT><A HREF="#lbAB">NAME</A><DD>
<DT><A HREF="#lbAC">SYNOPSIS</A><DD>
<DT><A HREF="#lbAD">DESCRIPTION</A><DD>
<DT><A HREF="#lbAE">RETURN VALUE</A><DD>
<DT><A HREF="#lbAF">ERRORS</A><DD>
<DT><A HREF="#lbAG">CONFORMING TO</A><DD>
<DT><A HREF="#lbAH">NOTES</A><DD>
<DT><A HREF="#lbAI">SEE ALSO</A><DD>
</DL>
<HR>
This document was created by
<A HREF="http://localhost/cgi-bin/man/man2html">man2html</A>,
using the manual pages.<BR>
Time: 02:50:01 GMT, April 20, 2020
</BODY>
</HTML>
