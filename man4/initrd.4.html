<!--
-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML><HEAD><TITLE>Man page of INITRD</TITLE>
</HEAD><BODY>
<H1>INITRD</H1>
Section: Linux Programmer's Manual (4)<BR>Updated: 1997-11-06<BR><A HREF="#index">Index</A>
<A HREF="../index.html">Return to Main Contents</A><HR>

<A NAME="lbAB">&nbsp;</A>
<H2>NAME</H2>

initrd - boot loader initialized RAM disk



<A NAME="lbAC">&nbsp;</A>
<H2>DESCRIPTION</H2>

The special file 
<B>/dev/initrd </B>

is a read-only block device.  
Device 
<B>/dev/initrd</B>

is a RAM disk that is initialized (e.g. loaded) by the boot loader before
the kernel is started.
The kernel then can use the block device
<B>/dev/initrd</B>'s 

contents for a two phased system boot-up.
<P>

In the first boot-up phase, the kernel starts up 
and mounts an initial root file-system from the contents 
of 
<B>/dev/initrd </B>

(e.g. RAM disk initialized by the boot loader). 
In the second phase, additional drivers or other modules 
are loaded from the initial root device's contents.  
After loading the additional modules, a new root file system 
(i.e. the normal root file system) is mounted from a 
different device.



<A NAME="lbAD">&nbsp;</A>
<H2>BOOT-UP OPERATION</H2>

When booting up with 
<B>initrd</B>, the system boots as follows:

<DL COMPACT><DT><DD>
<P>

1. The boot loader loads the kernel program and 
<B>/dev/initrd</B>'s contents into memory.

<P>

2. On kernel startup, the kernel uncompresses and copies the contents of the device 
<B>/dev/initrd</B>

onto device 
<B>/dev/ram0 </B>

and then frees the memory used by 
<B>/dev/initrd</B>.

<P>

3. The kernel then read-write mounts device
<B>/dev/ram0 </B>

as the initial root file system.
<P>

4. If the indicated normal root file system is also the initial root file-system
(e.g. 
<B>/dev/ram0</B>

) then the kernel skips to the last step for the usual boot sequence.
<P>

5. If the executable file 
<B>/linuxrc</B> is present in the initial root file-system, <B>/linuxrc</B>

is executed with UID 0.  
(The file 
<B>/linuxrc</B>

must have executable permission.  
The file 
<B>/linuxrc</B>

can be any valid executable, including a shell script.)  
<P>

6. If  
<B>/linuxrc</B>

is not executed or when 
<B>/linuxrc</B>

terminates, the normal root file system is mounted.  
(If
<B>/linuxrc</B>

exits with any file-systems mounted on the initial root 
file-system, then the behavior of the kernel is 
<B>UNSPECIFIED</B>.

See the 
<B>NOTES</B>

section for the current kernel behavior.)
<P>

7. If the normal root file has directory 
<B>/initrd</B>, device

<B>/dev/ram0</B>

is moved from 
<B>/</B> to <B>/initrd</B>.

Otherwise if directory  
<B>/initrd</B> does not exist device <B>/dev/ram0</B> is unmounted.

(When moved from 
<B>/</B> to <B>/initrd</B>, <B>/dev/ram0</B>

is not unmounted and therefore processes can remain running from 
<B>/dev/ram0</B>.

If directory 
<B>/initrd</B>

does not exist on the normal root file-system 
and any processes remain running from  
<B>/dev/ram0</B> when <B>/linuxrc</B>

exits, the behavior of the kernel is 
<B>UNSPECIFIED</B>.

See the 
<B>NOTES</B>

section for the current kernel behavior.)
<P>

8. The usual boot sequence (e.g. invocation of 
<B>/sbin/init</B>) is performed on the normal root file system.




</DL>
<A NAME="lbAE">&nbsp;</A>
<H2>OPTIONS</H2>

The following boot loader options when used with 
<B>initrd</B>, affect the kernel's boot-up operation:

<DL COMPACT>
<DT><B>initrd=</B><I>filename</I>

<DD>
Specifies the file to load as the contents of 
<B>/dev/initrd</B>.

For <B>LOADLIN</B>

this is a command line option.
For <B>LILO</B> you have to use this command in the 

<B>LILO</B> configuration file <B>/etc/lilo.config</B>.

The filename specified with this
option will typically be a gzipped file-system image.
<DT><B>noinitrd</B>

<DD>
This boot time option disables the two phase boot-up operation.
The kernel performs the usual boot sequence as if 
<B>/dev/initrd </B>

was not initialized. 
With this option, any contents of
<B>/dev/initrd </B>

loaded into memory by the boot loader contents are preserved.
This option permits the contents of 
<B>/dev/initrd</B>

to be any data and need not be limited to a file system image.  
However, device  
<B>/dev/initrd </B>

is read-only and can be read only one time after system startup.
<DT><B>root=</B><I>device-name</I>

<DD>
Specifies the device to be used as the normal root file system. 
For <B>LOADLIN</B>

this is a command line option.
For <B>LILO</B> this is a boot time option or

can be used as an option line in the  
<B>LILO</B> configuration file <B>/etc/lilo.config</B>.

The device specified by the this option must be a mountable 
device having a suitable root file-system.



</DL>
<A NAME="lbAF">&nbsp;</A>
<H2>CHANGING THE NORMAL ROOT FILE SYSTEM</H2>

By default, 
the kernel's settings
(e.g. set in the kernel file with 
<B>rdev</B>

or compiled into the kernel file),
or the boot loader option setting
is used for the normal root file systems.
For a NFS-mounted normal root file system, one has to use the 
<B>nfs_root_name</B> and <B>nfs_root_addrs</B>

boot options to give the NFS settings. 
For more information on NFS-mounted root see the kernel documentation file
<B>nfsroot.txt</B>.

For more information on setting the root file system also see the
<B>LILO</B> and <B>LOADLIN</B> documentation.

<P>

It is also possible for the 
<B>/linuxrc</B>

executable to change the normal root device.
For 
<B>/linuxrc</B>

to change the normal root device, 
<B>/proc</B> must be mounted.

After mounting 
<B>/proc</B>, <B>/linuxrc</B>

changes the normal root device by writing into the proc files
<B>/proc/sys/kernel/real-root-dev</B>, 

<B>/proc/sys/kernel/nfs-root-name</B>, and 

<B>/proc/sys/kernel/nfs-root-addrs</B>.

For a physical root device, the root device is changed by having
<B>/linuxrc</B>

write the new root file system device number into
<B>/proc/sys/kernel/real-root-dev</B>.

For a NFS root file system, the root device is changed by having
<B>/linuxrc</B>

write the NFS setting into files
<B>/proc/sys/kernel/nfs-root-name</B> and 

<B>/proc/sys/kernel/nfs-root-addrs</B>

and then writing 0xff (e.g. the pseudo-NFS-device number) into file
<B>/proc/sys/kernel/real-root-dev</B>.

For example, the following shell command line would change
the normal root device to 
<B>/dev/hdb1</B>:

<PRE>
        echo 0x365 &gt;/proc/sys/kernel/real-root-dev
</PRE>

For a NFS example, the following shell command lines would change the 
normal root device to the NFS directory 
<B>/var/nfsroot</B>

on a local networked NFS server with IP number 193.8.232.7 for a system with 
IP number 193.8.232.7 and named 'idefix':
<PRE>
        echo /var/nfsroot &gt;/proc/sys/kernel/nfs-root-name
        echo 193.8.232.2:193.8.232.7::255.255.255.0:idefix \
          &gt;/proc/sys/kernel/nfs-root-addrs
        echo 255 &gt;/proc/sys/kernel/real-root-dev
</PRE>

<P>
<B>Note</B>:

The use of
<B>/proc/sys/kernel/real-root-dev</B>

to change the root file system is obsolete.
See the kernel source file
<I>Documentation/initrd.txt</I>

as well as
<B><A HREF="../man2/pivot_root.2.html">pivot_root</A></B>(2)

and
<B><A HREF="../man8/pivot_root.8.html">pivot_root</A></B>(8)

for information on the modern method of changing the root file system. 




<A NAME="lbAG">&nbsp;</A>
<H2>USAGE</H2>

The main motivation for implementing 
<B>initrd</B>

was to allow for modular kernel configuration at system installation. 
<P>

A possible system installation scenario is as follows:
<DL COMPACT><DT><DD>
<P>

1. The loader program boots from floppy or other media with a minimal kernel
(e.g. support for 
<B>/dev/ram</B>, <B>/dev/initrd</B>, and the ext2 file-system) and loads 

<B>/dev/initrd</B> with a gzipped version of the initial file-system.

<P>

2. The executable 
<B>/linuxrc</B>

determines what is needed to (1) mount the normal root file-system
(i.e. device type, device drivers, file system) and (2) the
distribution media (e.g. CD-ROM, network, tape, ...). This can be
done by asking the user, by auto-probing, or by using a hybrid
approach.
<P>

3. The executable 
<B>/linuxrc</B>

loads the necessary modules from the initial root file-system.
<P>

4. The executable 
<B>/linuxrc</B>

creates and populates the root file system.  (At this stage the normal
root file system does not have to be a
completed system yet.)
<P>

5. The executable 
<B>/linuxrc</B> sets <B>/proc/sys/kernel/real-root-dev,</B>

unmount 
<B>/proc</B>, 

the normal root file system and any other file
systems it has mounted, and then terminates.
<P>

6. The kernel then mounts the normal root file system.
<P>

7. Now that the file system is accessible and intact,
the boot loader can be installed.
<P>

8. The boot loader is configured to load into
<B>/dev/initrd</B>

a file system with the set of modules that was used to bring up the system. 
(e.g. Device
<B>/dev/ram0</B>

can be modified, then unmounted, and finally, the image is written from
<B>/dev/ram0</B>

to a file.)
<P>

9. The system is now bootable and additional installation tasks can be
performed.
</DL>

<P>

The key role of 
<B>/dev/initrd</B>

in the above is to re-use the configuration data during normal system operation 
without requiring initial kernel selection, a large generic kernel or,
recompiling the kernel.
<P>

A second scenario is for installations where Linux runs on systems with
different hardware configurations in a single administrative network. 
In such cases, it may be desirable to use only a small set of kernels
(ideally only one) and to keep the system-specific part of configuration
information as small as possible. 
In this case, create a common file 
with all needed modules. 
Then, only the 
<B>/linuxrc</B>

file or a file executed by
<B>/linuxrc</B>

would be different.
<P>

A third scenario is more convenient recovery disks. 
Because information like the location of the root file-system 
partition is not needed at boot time, the system loaded from 
<B>/dev/initrd </B>

can use a dialog and/or auto-detection followed by a 
possible sanity check.
<P>

Last but not least, Linux distributions on CD-ROM may use 
<B>initrd</B>

for easy installation from the CD-ROM.  
The distribution can use 
<B>LOADLIN</B>

to directly load 
<B>/dev/initrd</B>

from CD-ROM without the need of any floppies.
The distribution could also use a 
<B>LILO</B>

boot floppy and then bootstrap a bigger ram disk via
<B>/dev/initrd</B> from the CD-ROM.




<A NAME="lbAH">&nbsp;</A>
<H2>CONFIGURATION</H2>

The 
<B>/dev/initrd </B>

is a read-only block device assigned 
major number 1 and minor number 250.  
Typically 
<B>/dev/initrd</B>

is owned by 
<B>root.disk </B>

with mode 0400 (read access by root only).
If the Linux system does not have
<B>/dev/initrd</B>

already created, it can be created with the following commands:
<PRE>
<B>
        mknod -m 400 /dev/initrd b 1 250
        chown root:disk /dev/initrd
</B>
</PRE>

Also, support for both &quot;RAM disk&quot; and &quot;Initial RAM disk&quot; 
(e.g. 
<B>CONFIG_BLK_DEV_RAM=y</B> and <B>CONFIG_BLK_DEV_INITRD=y</B>

) support must be compiled directly into the Linux kernel to use 
<B>/dev/initrd</B>.

When using 
<B>/dev/initrd</B>, 

the RAM disk driver cannot be loaded as a module.



<A NAME="lbAI">&nbsp;</A>
<H2>FILES</H2>

<I>/dev/initrd</I>

<BR>

<I>/dev/ram0</I>

<BR>

<I>/linuxrc</I>

<BR>

<I>/initrd</I>

<A NAME="lbAJ">&nbsp;</A>
<H2>SEE ALSO</H2>

<B><A HREF="../man1/chown.1.html">chown</A></B>(1),

<B><A HREF="../man1/mknod.1.html">mknod</A></B>(1),

<B><A HREF="../man4/ram.4.html">ram</A></B>(4),

<B><A HREF="../man8/freeramdisk.8.html">freeramdisk</A></B>(8),

<B><A HREF="../man8/rdev.8.html">rdev</A></B>(8)

<P>
The documentation file
<I>initrd.txt</I>

in the kernel source package, the LILO documentation,
the LOADLIN documentation, the SYSLINUX documentation.



<A NAME="lbAK">&nbsp;</A>
<H2>NOTES</H2>

1. With the current kernel, any file systems that remain mounted when
<B>/dev/ram0</B> is moved from <B>/</B> to <B>/initrd</B>

continue to be accessible.  However, the
<B>/proc/mounts</B>

entries are not updated. 
<P>

2. With the current kernel, if directory 
<B>/initrd</B> does not exist, then <B>/dev/ram0</B>

will NOT be fully unmounted if 
<B>/dev/ram0</B>

is used by any process or has any file-system mounted on it.
If  
<B>/dev/ram0</B> is NOT fully unmounted, 

then  
<B>/dev/ram0</B>

will remain in memory.
<P>

3. Users of 
<B>/dev/initrd</B>

should not depend on the behavior give in the above notes.  
The behavior may change in future versions of the Linux kernel.



<A NAME="lbAL">&nbsp;</A>
<H2>AUTHOR</H2>

The kernel code for device 
<B>initrd</B>

was written by Werner Almesberger &lt;<A HREF="mailto:almesber@lrc.epfl.ch">almesber@lrc.epfl.ch</A>&gt; and 
Hans Lermen &lt;<A HREF="mailto:lermen@elserv.ffm.fgan.de">lermen@elserv.ffm.fgan.de</A>&gt;.
The code for
<B>initrd</B>

was added to the baseline Linux kernel in development version 1.3.73.
<P>

<HR>
<A NAME="index">&nbsp;</A><H2>Index</H2>
<DL>
<DT><A HREF="#lbAB">NAME</A><DD>
<DT><A HREF="#lbAC">DESCRIPTION</A><DD>
<DT><A HREF="#lbAD">BOOT-UP OPERATION</A><DD>
<DT><A HREF="#lbAE">OPTIONS</A><DD>
<DT><A HREF="#lbAF">CHANGING THE NORMAL ROOT FILE SYSTEM</A><DD>
<DT><A HREF="#lbAG">USAGE</A><DD>
<DT><A HREF="#lbAH">CONFIGURATION</A><DD>
<DT><A HREF="#lbAI">FILES</A><DD>
<DT><A HREF="#lbAJ">SEE ALSO</A><DD>
<DT><A HREF="#lbAK">NOTES</A><DD>
<DT><A HREF="#lbAL">AUTHOR</A><DD>
</DL>
<HR>
This document was created by
<A HREF="http://localhost/cgi-bin/man/man2html">man2html</A>,
using the manual pages.<BR>
Time: 02:16:18 GMT, April 20, 2020
</BODY>
</HTML>
