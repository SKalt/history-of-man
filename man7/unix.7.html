<!--
-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML><HEAD><TITLE>Man page of UNIX</TITLE>
</HEAD><BODY>
<H1>UNIX</H1>
Section: Linux Programmer's Manual (7)<BR>Updated: 2004-05-27<BR><A HREF="#index">Index</A>
<A HREF="../index.html">Return to Main Contents</A><HR>

<A NAME="lbAB">&nbsp;</A>
<H2>NAME</H2>

unix, PF_UNIX, AF_UNIX, PF_LOCAL, AF_LOCAL - Sockets for local
interprocess communication
<A NAME="lbAC">&nbsp;</A>
<H2>SYNOPSIS</H2>

<B>#include &lt;<A HREF="file:///usr/include/sys/socket.h">sys/socket.h</A>&gt;</B>

<BR>

<B>#include &lt;<A HREF="file:///usr/include/sys/un.h">sys/un.h</A>&gt;</B>

<P>
<I>unix_socket</I><B> = socket(PF_UNIX, type, 0);</B>

<BR>

<I>error</I><B> = socketpair(PF_UNIX, type, 0, int *</B><I>sv</I><B>);</B>

<A NAME="lbAD">&nbsp;</A>
<H2>DESCRIPTION</H2>

The
<B>PF_UNIX</B>

(also known as
<B>PF_LOCAL</B>)

socket family is used to communicate between processes on the same machine
efficiently.
Unix sockets can be either anonymous (created by
<B><A HREF="../man2/socketpair.2.html">socketpair</A></B>(2))

or associated with a file of type socket.
Linux also supports an abstract namespace which is independent of the
file system.
<P>
Valid types are:
<B>SOCK_STREAM</B>,

for a stream-oriented socket and
<B>SOCK_DGRAM</B>,

for a datagram-oriented socket that preserves message boundaries
(as on most Unix implementations, Unix domain datagram
sockets are always reliable and don't reorder datagrams);
and (since kernel 2.6.4)
<B>SOCK_SEQPACKET</B>,

for a connection-oriented socket that preserves message boundaries
and delivers messages in the order that they were sent.
<P>
Unix sockets support passing file descriptors or process credentials
to other processes using ancillary data.
<A NAME="lbAE">&nbsp;</A>
<H3>Address Format</H3>

A Unix address is defined as a filename in the filesystem or
as a unique string in the abstract namespace.
Sockets created by
<B><A HREF="../man2/socketpair.2.html">socketpair</A></B>(2)

are anonymous.
For non-anonymous sockets the target address can be set
using
<B><A HREF="../man2/connect.2.html">connect</A></B>(2).

The local address can be set using
<B><A HREF="../man2/bind.2.html">bind</A></B>(2).

When a socket is connected and it doesn't already have a local address a
unique address in the abstract namespace will be generated automatically.
<P>

<PRE>
#define UNIX_PATH_MAX    108

struct sockaddr_un {
    sa_family_t    sun_family;               /* AF_UNIX */
    char           sun_path[UNIX_PATH_MAX];  /* pathname */
};
</PRE>


<P>
<B>sun_family</B>

always contains
<B>AF_UNIX</B>.

<B>sun_path</B>

contains the zero-terminated pathname of the socket in the file system.
If
<B>sun_path</B>

starts with a null byte (''&nbsp;'),
then it refers to the abstract namespace maintained by
the Unix protocol module.
The socket's address in this namespace is given by the rest of the
bytes in
<B>sun_path</B>.

Note that names in the abstract namespace are not zero-terminated.
<A NAME="lbAF">&nbsp;</A>
<H3>Socket Options</H3>

For historical reasons these socket options are specified with a
SOL_SOCKET type even though they are PF_UNIX specific.
They can be set with
<B><A HREF="../man2/setsockopt.2.html">setsockopt</A></B>(2)

and read with
<B><A HREF="../man2/getsockopt.2.html">getsockopt</A></B>(2)

by specifying SOL_SOCKET as the socket family.
<DL COMPACT>
<DT><B>SO_PASSCRED</B>

<DD>
Enables the receiving of the credentials of the sending process
ancillary message.
When this option is set and the socket is not yet connected
a unique name in the abstract namespace will be generated automatically.
Expects an integer boolean flag.
</DL>
<A NAME="lbAG">&nbsp;</A>
<H3>(Un)supported Features</H3>

The following paragraphs describe domain-specific details and
unsupported features of the sockets API for Unix domain sockets on Linux.
<P>
Unix domain sockets do not support the transmission of
out-of-band data (the
<B>MSG_OOB</B>

flag for
<B><A HREF="../man2/send.2.html">send</A></B>(2)

and
<B><A HREF="../man2/recv.2.html">recv</A></B>(2)).

<P>
The
<B><A HREF="../man2/send.2.html">send</A></B>(2)

<B>MSG_MORE</B>

flag is not supported by Unix domain sockets.
<P>
The
<B>SO_SNDBUF</B>

socket option does have an effect for Unix domain sockets, but the
<B>SO_RCVBUF</B>

option does not.
For datagram sockets, the
<B>SO_SNDBUF</B>

value imposes an upper limit on the size of outgoing datagrams.
This limit is calculated as the doubled (see
<B><A HREF="../man7/socket.7.html">socket</A></B>(7))

option value less 32 bytes used for overhead.
<A NAME="lbAH">&nbsp;</A>
<H3>Ancillary Messages</H3>

Ancillary data is sent and received using
<B><A HREF="../man2/sendmsg.2.html">sendmsg</A></B>(2)

and
<B><A HREF="../man2/recvmsg.2.html">recvmsg</A></B>(2).

For historical reasons the ancillary message types listed below
are specified with a SOL_SOCKET type even though they are PF_UNIX
specific.
To send them set the
<B>cmsg_level</B>

field of the struct
<B>cmsghdr</B>

to SOL_SOCKET and the
<B>cmsg_type</B>

field to the type.
For more information see
<B><A HREF="../man3/cmsg.3.html">cmsg</A></B>(3).

<DL COMPACT>
<DT><B>SCM_RIGHTS</B>

<DD>
Send or receive a set of open file descriptors from another process.
The data portion contains an integer array of the file descriptors.
The passed file descriptors behave as though they have been created with
<B><A HREF="../man2/dup.2.html">dup</A></B>(2).

<DT><B>SCM_CREDENTIALS</B>

<DD>
Send or receive Unix credentials.
This can be used for authentication.
The credentials are passed as a
<I>struct ucred</I>

ancillary message.
<P>

<PRE>
struct ucred {
    pid_t pid;    /* process ID of the sending process */
    uid_t uid;    /* user ID of the sending process */
    gid_t gid;    /* group ID of the sending process */
};
</PRE>


<P>
The credentials which the sender specifies are checked by the kernel.
A process with effective user ID 0 is allowed to specify values that do
not match its own.
The sender must specify its own process ID (unless it has the capability
<B>CAP_SYS_ADMIN</B>),

its user ID, effective user ID, or saved set-user-ID (unless it has
<B>CAP_SETUID</B>),

and its group ID, effective group ID, or saved set-group-ID
(unless it has
<B>CAP_SETGID</B>).

To receive a
<I>struct ucred</I>

message the
<B>SO_PASSCRED</B>

option must be enabled on the socket.
</DL>
<A NAME="lbAI">&nbsp;</A>
<H2>ERRORS</H2>

<DL COMPACT>
<DT><B>ENOMEM</B>

<DD>
Out of memory.
<DT><B>ECONNREFUSED</B>

<DD>
<B><A HREF="../man2/connect.2.html">connect</A></B>(2)

called with a socket object that isn't listening.
This can happen when
the remote socket does not exist or the filename is not a socket.
<DT><B>EINVAL</B>

<DD>
Invalid argument passed.
A common cause is the missing setting of AF_UNIX
in the
<I>sun_type</I>

field of passed addresses or the socket being in an
invalid state for the applied operation.
<DT><B>EOPNOTSUPP</B>

<DD>
Stream operation called on non-stream oriented socket or tried to
use the out-of-band data option.
<DT><B>EPROTONOSUPPORT</B>

<DD>
Passed protocol is not PF_UNIX.
<DT><B>ESOCKTNOSUPPORT</B>

<DD>
Unknown socket type.
<DT><B>EPROTOTYPE</B>

<DD>
Remote socket does not match the local socket type (SOCK_DGRAM vs.
SOCK_STREAM)
<DT><B>EADDRINUSE</B>

<DD>
Selected local address is already taken or filesystem socket
object already exists.
<DT><B>EISCONN</B>

<DD>
<B><A HREF="../man2/connect.2.html">connect</A></B>(2)

called on an already connected socket or a target address was
specified on a connected socket.
<DT><B>ENOTCONN</B>

<DD>
Socket operation needs a target address, but the socket is not connected.
<DT><B>ECONNRESET</B>

<DD>
Remote socket was unexpectedly closed.
<DT><B>EPIPE</B>

<DD>
Remote socket was closed on a stream socket.
If enabled, a
<B>SIGPIPE</B>

is sent as well.
This can be avoided by passing the
<B>MSG_NOSIGNAL</B>

flag to
<B><A HREF="../man2/sendmsg.2.html">sendmsg</A></B>(2)

or
<B><A HREF="../man2/recvmsg.2.html">recvmsg</A></B>(2).

<DT><B>EFAULT</B>

<DD>
User memory address was not valid.
<DT><B>EPERM</B>

<DD>
The sender passed invalid credentials in the
<I>struct ucred</I>.

</DL>
<P>

Other errors can be generated by the generic socket layer or
by the filesystem while generating a filesystem socket object.
See the appropriate manual pages for more information.
<A NAME="lbAJ">&nbsp;</A>
<H2>VERSIONS</H2>

<B>SCM_CREDENTIALS</B>

and the abstract namespace were introduced with Linux 2.2 and should not
be used in portable programs.
(Some BSD-derived systems also support credential passing,
but the implementation details differ.)
<A NAME="lbAK">&nbsp;</A>
<H2>NOTES</H2>

In the Linux implementation, sockets which are visible in the
filesystem honour the permissions of the directory they are in.
Their owner, group and their permissions can be changed.
Creation of a new socket will fail if the process does not have write and
search (execute) permission on the directory the socket is created in.
Connecting to the socket object requires read/write permission.
This behavior differs from many BSD-derived systems which
ignore permissions for Unix sockets.
Portable programs should not rely on
this feature for security.
<P>
Binding to a socket with a filename creates a socket
in the file system that must be deleted by the caller when it is no
longer needed (using
<B><A HREF="../man2/unlink.2.html">unlink</A></B>(2)).

The usual Unix close-behind semantics apply; the socket can be unlinked
at any time and will be finally removed from the file system when the last
reference to it is closed.
<P>
To pass file descriptors or credentials over a SOCK_STREAM, you need
to send or receive at least one byte of non-ancillary data in the same
<B><A HREF="../man2/sendmsg.2.html">sendmsg</A></B>(2)

or
<B><A HREF="../man2/recvmsg.2.html">recvmsg</A></B>(2)

call.
<P>
Unix domain stream sockets do not support the notion of out-of-band data.
<A NAME="lbAL">&nbsp;</A>
<H2>SEE ALSO</H2>

<B><A HREF="../man2/recvmsg.2.html">recvmsg</A></B>(2),

<B><A HREF="../man2/sendmsg.2.html">sendmsg</A></B>(2),

<B><A HREF="../man2/socket.2.html">socket</A></B>(2),

<B><A HREF="../man2/socketpair.2.html">socketpair</A></B>(2),

<B><A HREF="../man3/cmsg.3.html">cmsg</A></B>(3),

<B><A HREF="../man7/capabilities.7.html">capabilities</A></B>(7),

<B><A HREF="../man7/socket.7.html">socket</A></B>(7)

<P>

<HR>
<A NAME="index">&nbsp;</A><H2>Index</H2>
<DL>
<DT><A HREF="#lbAB">NAME</A><DD>
<DT><A HREF="#lbAC">SYNOPSIS</A><DD>
<DT><A HREF="#lbAD">DESCRIPTION</A><DD>
<DL>
<DT><A HREF="#lbAE">Address Format</A><DD>
<DT><A HREF="#lbAF">Socket Options</A><DD>
<DT><A HREF="#lbAG">(Un)supported Features</A><DD>
<DT><A HREF="#lbAH">Ancillary Messages</A><DD>
</DL>
<DT><A HREF="#lbAI">ERRORS</A><DD>
<DT><A HREF="#lbAJ">VERSIONS</A><DD>
<DT><A HREF="#lbAK">NOTES</A><DD>
<DT><A HREF="#lbAL">SEE ALSO</A><DD>
</DL>
<HR>
This document was created by
<A HREF="http://localhost/cgi-bin/man/man2html">man2html</A>,
using the manual pages.<BR>
Time: 02:39:09 GMT, April 20, 2020
</BODY>
</HTML>
